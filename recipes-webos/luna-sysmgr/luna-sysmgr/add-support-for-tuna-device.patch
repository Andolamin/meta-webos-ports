From 5d39559cf8d304291b26c6be82d38ee275e8f9cc Mon Sep 17 00:00:00 2001
From: Simon Busch <morphis@gravedo.de>
Date: Wed, 19 Sep 2012 08:35:15 +0200
Subject: [PATCH 2/2] Add support for the tuna device

Open-webOS-DCO-1.0-Signed-off-by: Simon Busch <morphis@gravedo.de>
---
 Src/webbase/WebAppManager.cpp |    2 +-
 conf/luna-tuna.conf           |   56 +++++++++++++++++++++++++++++++++++++++++
 device.pri                    |   19 +++++++++++---
 3 files changed, 72 insertions(+), 5 deletions(-)
 create mode 100644 conf/luna-tuna.conf

diff --git a/Src/webbase/WebAppManager.cpp b/Src/webbase/WebAppManager.cpp
index 7bad3b6..a471598 100644
--- a/Src/webbase/WebAppManager.cpp
+++ b/Src/webbase/WebAppManager.cpp
@@ -211,7 +211,7 @@ WebAppManager::WebAppManager()
     setenv("QT_PLUGIN_PATH", "/usr/plugins", 1);
     setenv("QT_DEBUG_PLUGINS", "1", 1);
 
-#if defined(TARGET_DEVICE)
+#if defined(TARGET_DEVICE) && !defined(MACHINE_TUNA)
     static const char *argv[] = { "./WebAppManager", "-platform", "webos", NULL };
 #else
     static const char *argv[] = { "./WebAppManager", "-platform", "minimal", NULL };
diff --git a/conf/luna-tuna.conf b/conf/luna-tuna.conf
new file mode 100644
index 0000000..0c17cf9
--- /dev/null
+++ b/conf/luna-tuna.conf
@@ -0,0 +1,56 @@
+# @@@LICENSE
+#
+#      Copyright (c) 2010-2012 Hewlett-Packard Development Company, L.P.
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+# LICENSE@@@
+# @@@LICENSE
+#
+#      Copyright (c) 2010 Hewlett-Packard Development Company, L.P.
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+# http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+# LICENSE@@@
+[LaunchAtBoot]
+Applications=com.palm.app.phone;com.palm.app.email
+
+[General]
+ShowReticle=true
+DisplayWidth=480
+DisplayHeight=800
+
+[UI]
+TabletUi=true
+DisplayUiRotates=true
+HomeButtonOrientationAngle=0
+ActiveCardWindowRatio=0.50
+NonActiveCardWindowRatio=0.45
+CardGroupRotFactor=90
+GapBetweenCardGroups=10
+
+[Display]
+TurnOffAccelerometerWhenDimmed=false
+
+[VirtualKeyboard]
+VirtualKeyboardEnabled=true
diff --git a/device.pri b/device.pri
index e366eb2..68732f9 100644
--- a/device.pri
+++ b/device.pri
@@ -81,7 +81,7 @@ contains(MACHINE_NAME, "pyramid") {
 	DEFINES += MACHINE_PYRAMID
 	CONFIG_BUILD += opengl 
 	CONFIG_BUILD += haptics
-    LIBS += -lqpalm
+LIBS += -lqpalm
 }
 contains(MACHINE_NAME, "qemux86") {
     DEFINES += MACHINE_QEMUX86
@@ -94,6 +94,13 @@ contains(MACHINE_NAME, "qemux86") {
     SOURCES += SoundPlayerDummy.cpp
     HEADERS += SoundPlayerDummy.h
 }
+contains(MACHINE_NAME, "tuna") {
+    DEFINES += MACHINE_TUNA MACHINE_PUBLIC_QUIRKS
+    TARGET_TYPE = TARGET_DEVICE
+    SOURCES += SoundPlayerDummy.cpp
+    HEADERS += SoundPlayerDummy.h
+    LIBS += -lqpalm
+}
 
 DEFINES += $$TARGET_TYPE HAVE_LUNA_PREF=1 PALM_DEVICE QT_PLUGIN QT_STATICPLUGIN
 
@@ -121,7 +128,11 @@ INCLUDEPATH += \
 
 contains(TARGET_TYPE, TARGET_DEVICE) {
         INCLUDEPATH +=  $$(STAGING_INCDIR)/hid/IncsPublic
-        SOURCES += SoundPlayer.cpp
-        HEADERS += SoundPlayer.h
-        LIBS += -lmedia-api  -lserviceinstall -laffinity -lhid -lmemchute
+        contains(MACHINE_NAME, "tuna") {
+        }
+        else {
+            SOURCES += SoundPlayer.cpp
+            HEADERS += SoundPlayer.h
+            LIBS += -lmedia-api  -lserviceinstall -laffinity -lhid -lmemchute
+        }
 }
-- 
1.7.9.5

