From ab24c327a52e27ba429a217ee9c41e8c3a12d5a6 Mon Sep 17 00:00:00 2001
From: David Henningsson <david.henningsson@canonical.com>
Date: Tue, 13 Aug 2013 12:43:29 +0200
Subject: [PATCH 6/7] card: Add hook before profile changes

This is useful to modules that want to do things just before a
profile becomes inactive.
---
 src/pulsecore/card.c | 2 ++
 src/pulsecore/core.h | 1 +
 2 files changed, 3 insertions(+)

diff --git a/src/pulsecore/card.c b/src/pulsecore/card.c
index 9a29aeb..00ca703 100644
--- a/src/pulsecore/card.c
+++ b/src/pulsecore/card.c
@@ -278,6 +278,8 @@ int pa_card_set_profile(pa_card *c, pa_card_profile *profile, bool save) {
         return 0;
     }
 
+    pa_hook_fire(&c->core->hooks[PA_CORE_HOOK_CARD_PROFILE_CHANGING], profile);
+
     if ((r = c->set_profile(c, profile)) < 0)
         return r;
 
diff --git a/src/pulsecore/core.h b/src/pulsecore/core.h
index f268e42..179cbb9 100644
--- a/src/pulsecore/core.h
+++ b/src/pulsecore/core.h
@@ -116,6 +116,7 @@ typedef enum pa_core_hook {
     PA_CORE_HOOK_CARD_PUT,
     PA_CORE_HOOK_CARD_UNLINK,
     PA_CORE_HOOK_CARD_PROFILE_CHANGED,
+    PA_CORE_HOOK_CARD_PROFILE_CHANGING,
     PA_CORE_HOOK_CARD_PROFILE_ADDED,
     PA_CORE_HOOK_CARD_PROFILE_AVAILABLE_CHANGED,
     PA_CORE_HOOK_PORT_AVAILABLE_CHANGED,
-- 
1.9.1

